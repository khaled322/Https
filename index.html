<!DOCTYPE html>
<html lang="ar" dir="rtl" id="htmlRoot">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title data-ar="تسجيل الدخول - تاجر هيلب" data-en="Login - Tadjir Help">تسجيل الدخول - تاجر هيلب</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Cairo:wght@400;700&display=swap" rel="stylesheet"/>
    <style>
        body {
            font-family: 'Cairo', 'Roboto', sans-serif;
            transition: all 0.4s ease-in-out;
            background-color: #ffffff;
            color: #1a202c;
        }
        .dark-mode {
            background-color: #121212;
            color: #e2e8f0;
        }
        .dark-mode #loginForm, .dark-mode #registerForm {
            background-color: #1e1e1e;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        .dark-mode input {
            background-color: #2d2d2d;
            color: #e2e8f0;
            border-color: #4a5568;
        }
        .dark-mode input:focus {
            border-color: #ecc94b;
            ring-color: #ecc94b;
        }
        .dark-mode button:not(.google-btn) {
            background-color: #ecc94b;
            color: #1a202c;
        }
        .dark-mode button:not(.google-btn):hover {
            background-color: #d69e2e;
        }
        .dark-mode .google-btn {
            background-color: #ffffff;
            color: #1a202c;
            border-color: #4a5568;
        }
        .dark-mode .google-btn:hover {
            background-color: #f7fafc;
        }
        .dark-mode a {
            color: #ecc94b;
        }
        .dark-mode .text-gray-600 {
            color: #a0aec0;
        }
        .input-field, .input-field-no-icon {
            position: relative;
            width: 100%;
        }
        .input-field input, .input-field-no-icon input {
            padding: 0.75rem 1rem;
            width: 100%;
            box-sizing: border-box;
            font-size: 1rem;
            line-height: 1.5;
            transition: all 0.3s ease;
        }
        .input-field input {
            padding-left: 2.25rem;
            padding-right: 1rem;
        }
        .input-field input:focus {
            transform: scale(1.02);
            border-color: #ecc94b;
            box-shadow: 0 0 5px rgba(236, 201, 75, 0.5);
        }
        .input-field i {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            font-size: 1rem;
            transition: color 0.3s ease;
        }
        .input-field i:hover {
            color: #ecc94b;
        }
        [dir="rtl"] .input-field i {
            left: 0.75rem;
        }
        [dir="ltr"] .input-field i {
            right: 0.75rem;
        }
        .btn, .google-btn {
            transition: all 0.3s ease;
        }
        .btn:hover, .google-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        }
        .btn:active, .google-btn:active {
            transform: scale(0.98);
        }
        .form-container {
            opacity: 0;
            transform: translateY(20px);
            animation: slideIn 0.5s ease forwards;
        }
        .hidden {
            display: none;
        }
        @keyframes slideIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .title-highlight {
            display: inline-block;
        }
        #toggleDarkMode, #toggleLanguage {
            transition: background-color 0.3s ease;
        }
        #toggleDarkMode:hover, #toggleLanguage:hover {
            background-color: #ecc94b;
            color: #1a202c;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen">
    <div class="fixed top-4 left-4 flex space-x-4">
        <button id="toggleDarkMode" class="bg-gray-200 px-3 py-1 rounded-md dark:bg-gray-700" aria-label="تبديل الوضع الداكن">
            <i class="fas fa-moon"></i>
        </button>
        <button id="toggleLanguage" class="bg-gray-200 px-3 py-1 rounded-md dark:bg-gray-700" aria-label="تغيير اللغة">EN</button>
    </div>

    <div id="loginForm" class="form-container w-full max-w-md mx-auto p-6 bg-gray-50 rounded-lg shadow-md">
        <div class="text-center mb-8">
            <h2 class="text-4xl font-bold">
                <span data-ar="تاجر" data-en="Tadjir">تاجر</span>
                <span class="text-yellow-500 title-highlight" data-ar="هيلب" data-en="Help">هيلب</span>
            </h2>
            <p class="text-gray-600 mt-2" data-ar="سجل الدخول إلى حسابك" data-en="Log in to your account">سجل الدخول إلى حسابك</p>
        </div>
        <form id="loginFormSubmit" class="space-y-6">
            <div class="input-field-no-icon">
                <input class="border rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500" 
                       placeholder="أدخل البريد الإلكتروني" data-ar="أدخل البريد الإلكتروني" data-en="Enter email" 
                       type="email" id="loginEmail" required/>
            </div>
            <div class="input-field">
                <input class="border rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500" 
                       id="password" placeholder="أدخل كلمة المرور" data-ar="أدخل كلمة المرور" data-en="Enter password" 
                       type="password" required/>
                <i class="fas fa-eye" id="togglePassword"></i>
            </div>
            <div class="text-left">
                <a class="text-sm text-gray-600 hover:underline" href="forgot-password.html" data-ar="نسيت كلمة المرور؟" data-en="Forgot Password?">نسيت كلمة المرور؟</a>
            </div>
            <p id="loginError" class="text-red-500 text-sm hidden"></p>
            <button class="btn w-full bg-yellow-500 text-white py-3 rounded-md font-bold hover:bg-yellow-600" 
                    type="submit" data-ar="تسجيل الدخول" data-en="Login">تسجيل الدخول</button>
        </form>
        <div class="mt-6">
            <button id="googleSignIn" class="google-btn w-full bg-white border border-gray-300 text-gray-700 py-3 rounded-md font-bold flex items-center justify-center space-x-2">
                <svg class="w-5 h-5" viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-1.02.68-2.31 1.08-3.71 1.08-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C4 20.36 7.9 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l3.66-2.84z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.9 1 4 3.64 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
                <span data-ar="تسجيل الدخول عبر Google" data-en="Sign in with Google">تسجيل الدخول عبر Google</span>
            </button>
        </div>
        <div class="text-center mt-6">
            <p class="text-sm text-gray-600">
                <span data-ar="ليس لديك حساب؟" data-en="Don't have an account?">ليس لديك حساب؟</span>
                <a class="text-yellow-500 font-bold cursor-pointer hover:underline" id="showRegisterForm" data-ar="إنشاء حساب" data-en="Create Account">إنشاء حساب</a>
            </p>
        </div>
    </div>

    <div id="registerForm" class="form-container w-full max-w-md mx-auto p-6 bg-gray-50 rounded-lg shadow-md hidden">
        <div class="text-center mb-8">
            <h2 class="text-4xl font-bold">
                <span data-ar="تاجر" data-en="Tadjir">تاجر</span>
                <span class="text-yellow-500 title-highlight" data-ar="هيلب" data-en="Help">هيلب</span>
            </h2>
            <p class="text-gray-600 mt-2" data-ar="أنشئ حسابك الجديد" data-en="Create your new account">أنشئ حسابك الجديد</p>
        </div>
        <form id="registrationForm" class="space-y-6">
            <div class="input-field-no-icon">
                <input class="border rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500" 
                       placeholder="الاسم الأول" data-ar="الاسم الأول" data-en="First Name" 
                       type="text" id="firstName" required/>
            </div>
            <div class="input-field-no-icon">
                <input class="border rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500" 
                       placeholder="اسم العائلة" data-ar="اسم العائلة" data-en="Last Name" 
                       type="text" id="lastName" required/>
            </div>
            <div class="input-field-no-icon">
                <input class="border rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500" 
                       placeholder="أدخل البريد الإلكتروني" data-ar="أدخل البريد الإلكتروني" data-en="Enter email" 
                       type="email" id="registerEmail" required/>
            </div>
            <div class="input-field">
                <input class="border rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500" 
                       id="registerPassword" placeholder="أدخل كلمة المرور" data-ar="أدخل كلمة المرور" data-en="Enter password" 
                       type="password" required/>
                <i class="fas fa-eye" id="toggleRegisterPassword"></i>
            </div>
            <div class="input-field">
                <input class="border rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500" 
                       id="confirmPassword" placeholder="تأكيد كلمة المرور" data-ar="تأكيد كلمة المرور" data-en="Confirm password" 
                       type="password" required/>
                <i class="fas fa-eye" id="toggleConfirmPassword"></i>
            </div>
            <p id="passwordError" class="text-red-500 text-sm hidden" data-ar="كلمات المرور غير متطابقة!" data-en="Passwords do not match!">كلمات المرور غير متطابقة!</p>
            <p id="registerError" class="text-red-500 text-sm hidden"></p>
            <button class="btn w-full bg-yellow-500 text-white py-3 rounded-md font-bold hover:bg-yellow-600" 
                    type="submit" data-ar="تسجيل" data-en="Register">تسجيل</button>
        </form>
        <div class="mt-6">
            <button id="googleSignUp" class="google-btn w-full bg-white border border-gray-300 text-gray-700 py-3 rounded-md font-bold flex items-center justify-center space-x-2">
                <svg class="w-5 h-5" viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-1.02.68-2.31 1.08-3.71 1.08-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C4 20.36 7.9 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l3.66-2.84z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.9 1 4 3.64 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
                <span data-ar="التسجيل عبر Google" data-en="Sign up with Google">التسجيل عبر Google</span>
            </button>
        </div>
        <div class="text-center mt-6">
            <p class="text-sm text-gray-600">
                <span data-ar="لديك حساب بالفعل؟" data-en="Already have an account?">لديك حساب بالفعل؟</span>
                <a class="text-yellow-500 font-bold cursor-pointer hover:underline" id="showLoginForm" data-ar="تسجيل الدخول" data-en="Login">تسجيل الدخول</a>
            </p>
        </div>
    </div>

    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCCQRblRXdM9vHYk_vitoMaDihD-YlXwzc",
            authDomain: "login-5ab63.firebaseapp.com",
            projectId: "login-5ab63",
            storageBucket: "login-5ab63.firebasestorage.app",
            messagingSenderId: "114075832736",
            appId: "1:114075832736:web:ea26dba6a7250417c594c5",
            measurementId: "G-W61905Q2Q1"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const googleProvider = new GoogleAuthProvider();

        // التحقق من حالة تسجيل الدخول
        onAuthStateChanged(auth, (user) => {
            if (user) {
                window.location.href = 'dashboard.html';
            }
        });

        document.addEventListener('DOMContentLoaded', () => {
            const togglePassword = document.querySelector('#togglePassword');
            const password = document.querySelector('#password');
            const toggleRegisterPassword = document.querySelector('#toggleRegisterPassword');
            const registerPassword = document.querySelector('#registerPassword');
            const toggleConfirmPassword = document.querySelector('#toggleConfirmPassword');
            const confirmPassword = document.querySelector('#confirmPassword');
            const showRegisterForm = document.querySelector('#showRegisterForm');
            const showLoginForm = document.querySelector('#showLoginForm');
            const loginForm = document.querySelector('#loginForm');
            const registerForm = document.querySelector('#registerForm');
            const passwordError = document.querySelector('#passwordError');
            const registerError = document.querySelector('#registerError');
            const loginError = document.querySelector('#loginError');
            const registrationForm = document.querySelector('#registrationForm');
            const loginFormSubmit = document.querySelector('#loginFormSubmit');
            const toggleDarkMode = document.querySelector('#toggleDarkMode');
            const toggleLanguage = document.querySelector('#toggleLanguage');
            const htmlRoot = document.querySelector('#htmlRoot');
            const googleSignIn = document.querySelector('#googleSignIn');
            const googleSignUp = document.querySelector('#googleSignUp');

            function togglePasswordVisibility(input, toggle) {
                if (input && toggle) {
                    toggle.addEventListener('click', () => {
                        const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
                        input.setAttribute('type', type);
                        toggle.classList.toggle('fa-eye-slash');
                    });
                }
            }
            togglePasswordVisibility(password, togglePassword);
            togglePasswordVisibility(registerPassword, toggleRegisterPassword);
            togglePasswordVisibility(confirmPassword, toggleConfirmPassword);

            if (showRegisterForm) {
                showRegisterForm.addEventListener('click', () => {
                    loginForm.classList.add('hidden');
                    registerForm.classList.remove('hidden');
                    registerForm.style.animation = 'slideIn 0.5s ease forwards';
                });
            }
            if (showLoginForm) {
                showLoginForm.addEventListener('click', () => {
                    registerForm.classList.add('hidden');
                    loginForm.classList.remove('hidden');
                    loginForm.style.animation = 'slideIn 0.5s ease forwards';
                });
            }

            if (confirmPassword) {
                confirmPassword.addEventListener('input', () => {
                    if (registerPassword.value !== confirmPassword.value) {
                        passwordError.classList.remove('hidden');
                    } else {
                        passwordError.classList.add('hidden');
                    }
                });
            }

            if (loginFormSubmit) {
                loginFormSubmit.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const email = document.querySelector('#loginEmail').value;
                    const password = document.querySelector('#password').value;
                    const submitButton = loginFormSubmit.querySelector('button');
                    submitButton.disabled = true;
                    submitButton.textContent = currentLang === 'ar' ? 'جارٍ التحميل...' : 'Loading...';

                    if (!email || !password) {
                        loginError.classList.remove('hidden');
                        loginError.textContent = currentLang === 'ar' ? 'يرجى إدخال البريد وكلمة المرور' : 'Please enter email and password';
                        submitButton.disabled = false;
                        submitButton.textContent = currentLang === 'ar' ? 'تسجيل الدخول' : 'Login';
                        return;
                    }

                    try {
                        const userCredential = await signInWithEmailAndPassword(auth, email, password);
                        console.log('تم تسجيل الدخول بنجاح:', userCredential.user);
                        window.location.href = 'dashboard.html';
                    } catch (error) {
                        loginError.classList.remove('hidden');
                        loginError.textContent = currentLang === 'ar' ? 
                            (error.code === 'auth/wrong-password' ? 'كلمة المرور غير صحيحة' : 
                             error.code === 'auth/user-not-found' ? 'المستخدم غير موجود' : 
                             error.message) : 
                            error.message;
                        console.error('خطأ في تسجيل الدخول:', error.code, error.message);
                    } finally {
                        submitButton.disabled = false;
                        submitButton.textContent = currentLang === 'ar' ? 'تسجيل الدخول' : 'Login';
                    }
                });
            }

            if (registrationForm) {
                registrationForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const firstName = document.querySelector('#firstName').value;
                    const lastName = document.querySelector('#lastName').value;
                    const email = document.querySelector('#registerEmail').value;
                    const password = registerPassword.value;
                    const confirmPasswordVal = confirmPassword.value;
                    const submitButton = registrationForm.querySelector('button');
                    submitButton.disabled = true;
                    submitButton.textContent = currentLang === 'ar' ? 'جارٍ التحميل...' : 'Loading...';

                    if (!email || !password || !firstName || !lastName) {
                        registerError.classList.remove('hidden');
                        registerError.textContent = currentLang === 'ar' ? 'يرجى ملء جميع الحقول' : 'Please fill all fields';
                        submitButton.disabled = false;
                        submitButton.textContent = currentLang === 'ar' ? 'تسجيل' : 'Register';
                        return;
                    }

                    if (password !== confirmPasswordVal) {
                        passwordError.classList.remove('hidden');
                        submitButton.disabled = false;
                        submitButton.textContent = currentLang === 'ar' ? 'تسجيل' : 'Register';
                        return;
                    }

                    try {
                        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                        console.log('تم إنشاء الحساب بنجاح:', userCredential.user);
                        window.location.href = 'dashboard.html';
                    } catch (error) {
                        registerError.classList.remove('hidden');
                        registerError.textContent = currentLang === 'ar' ? 
                            (error.code === 'auth/email-already-in-use' ? 'البريد الإلكتروني مستخدم بالفعل' : error.message) : 
                            error.message;
                        console.error('خطأ في إنشاء الحساب:', error.code, error.message);
                    } finally {
                        submitButton.disabled = false;
                        submitButton.textContent = currentLang === 'ar' ? 'تسجيل' : 'Register';
                    }
                });
            }

            function handleGoogleAuth(button, actionText, errorElement) {
                button.addEventListener('click', async () => {
                    button.disabled = true;
                    const originalText = button.querySelector('span').textContent;
                    button.querySelector('span').textContent = currentLang === 'ar' ? 'جارٍ التحميل...' : 'Loading...';

                    try {
                        const result = await signInWithPopup(auth, googleProvider);
                        console.log(`${actionText} باستخدام Google:`, result.user);
                        window.location.href = 'dashboard.html';
                    } catch (error) {
                        errorElement.classList.remove('hidden');
                        errorElement.textContent = currentLang === 'ar' ?
                            (error.code === 'auth/popup-blocked' ? 'تم حظر النافذة المنبثقة، الرجاء السماح بها' : error.message) :
                            error.message;
                        console.error(`خطأ في ${actionText} عبر Google:`, error.code, error.message);
                    } finally {
                        button.disabled = false;
                        button.querySelector('span').textContent = originalText;
                    }
                });
            }

            if (googleSignIn) handleGoogleAuth(googleSignIn, 'تسجيل الدخول', loginError);
            if (googleSignUp) handleGoogleAuth(googleSignUp, 'التسجيل', registerError);

            let currentLang = localStorage.getItem('language') || 'ar';
            if (toggleDarkMode) {
                const isDark = localStorage.getItem('darkMode') === 'true';
                if (isDark) {
                    document.body.classList.add('dark-mode');
                    toggleDarkMode.innerHTML = '<i class="fas fa-sun"></i>';
                }
                toggleDarkMode.addEventListener('click', () => {
                    document.body.classList.toggle('dark-mode');
                    const isDark = document.body.classList.contains('dark-mode');
                    toggleDarkMode.innerHTML = isDark ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
                    localStorage.setItem('darkMode', isDark);
                    updateTextContent();
                });
            }

            const eyeIcons = [togglePassword, toggleRegisterPassword, toggleConfirmPassword];
            if (toggleLanguage) {
                htmlRoot.setAttribute('lang', currentLang);
                htmlRoot.setAttribute('dir', currentLang === 'ar' ? 'rtl' : 'ltr');
                toggleLanguage.textContent = currentLang === 'ar' ? 'EN' : 'AR';
                updateTextContent();

                toggleLanguage.addEventListener('click', () => {
                    currentLang = currentLang === 'ar' ? 'en' : 'ar';
                    htmlRoot.setAttribute('lang', currentLang);
                    htmlRoot.setAttribute('dir', currentLang === 'ar' ? 'rtl' : 'ltr');
                    toggleLanguage.textContent = currentLang === 'ar' ? 'EN' : 'AR';
                    localStorage.setItem('language', currentLang);
                    updateTextContent();
                    eyeIcons.forEach(icon => {
                        if (currentLang === 'ar') {
                            icon.classList.remove('right-3');
                            icon.classList.add('left-3');
                        } else {
                            icon.classList.remove('left-3');
                            icon.classList.add('right-3');
                        }
                    });
                });
            }

            function updateTextContent() {
                document.querySelectorAll('[data-ar][data-en]').forEach(element => {
                    const text = element.getAttribute(`data-${currentLang}`);
                    if (element.tagName === 'INPUT') {
                        element.placeholder = text;
                    } else if (element.tagName === 'TITLE') {
                        document.title = text;
                    } else {
                        element.textContent = text;
                    }
                });
            }

            eyeIcons.forEach(icon => {
                if (icon) icon.classList.add('left-3');
            });
        });
    </script>
</body>
</html>
